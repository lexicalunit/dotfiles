#!/bin/bash

# Runs prettier on vue/js/ts files in the latest commit.

set -ue

if echo "$*" | grep -Eq -- '--help\b|-h\b'; then
    echo "usage: ${0##*/} [-h|--help]" 1>&2
    echo "Runs prettier on vue/js/ts files in the latest commit." 1>&2
    exit 1
fi

# shellcheck source=../.shell_control
# shellcheck disable=SC1091
source "$HOME/.shell_control" || echo "$(tput bold)error: ~/.shell_control not installed!$(tput sgr0)" >&2

git show --pretty="" --name-only HEAD | grep -iE "\.vue$|\.js$\.ts$" |
    while read -r JSFILE; do
        run "node_modules/.bin/prettier --write '$JSFILE'"
    done
