#!/bin/bash -u

# Toggle blinkstick between busy and available.

usage() {
    echo "usage: ${0##*/} [options]" 1>&2
    echo "" 1>&2
    echo "Toggle blinkstick between busy and available." 1>&2
    echo ""
    echo "options:"
    echo " -h or --help shows usage help" 1>&2
    exit 1
}

if echo "$*" | grep -Eq -- '--help\b|-h\b'; then
    usage
fi

LOCK="/tmp/.blinkstick-toggle"

if [[ -e "$LOCK" ]]; then
    /bin/rm "$LOCK"
    /usr/local/bin/blinkstick red
else
    /usr/bin/touch "$LOCK"
    /usr/local/bin/blinkstick green
fi
